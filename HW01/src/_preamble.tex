\documentclass[12pt, a4paper]{article}
\usepackage{xltxtra}

\usepackage{amsmath,amsfonts,amssymb,amsthm}
\usepackage{fontspec}
\defaultfontfeatures{Ligatures=TeX,Mapping=tex-text}
\setmainfont{CMU Serif}
\newfontfamily\cyrillicfont[Script=Cyrillic]{CMU Serif}
\setmonofont{CMU Typewriter Text}
\newfontfamily\cyrillicfonttt[Script=Cyrillic]{CMU Typewriter Text}
\setsansfont{CMU Sans Serif}
\newfontfamily\cyrillicfontsf[Script=Cyrillic]{CMU Sans Serif}

\usepackage{unicode-math}
\setmathfont{Latin Modern Math}

\usepackage{polyglossia}
\setmainlanguage[spelling=modern]{russian}
\setotherlanguage{english}
\setkeys{russian}{babelshorthands=true}

\usepackage[shortlabels]{enumitem}
\usepackage[russian,colorlinks,pagebackref]{hyperref}
\usepackage{listingsutf8}

\usepackage{fullpage}
\usepackage{color}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{indentfirst}

\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\graphicspath{{images/}}

\newtheorem{problem}{Задача}

\newenvironment{solution}
{\renewcommand\qedsymbol{$\blacksquare$}\begin{proof}[Решение]}
{\end{proof}}

\begin{document}
    \definecolor{dkgreen}{rgb}{0,0.6,0}
    \definecolor{gray}{rgb}{0.5,0.5,0.5}
    \definecolor{mauve}{rgb}{0.58,0,0.82}

    \newcommand{\problemset}[1]{

        \begin{center}
            \Large #1
        \end{center}
    }

    \newcommand{\defeq}{\overset{\mathrm{def}}{=\joinrel=}}

    \lstset{
        language=C++,                   % the language of the code
        basicstyle=\ttfamily\small,     % the size of the fonts that are used for the code
        backgroundcolor=\color{white},  % choose the background color. You must add \usepackage{color}
        numbers=none,                   % where to put the line-numbers
        numbersep=0pt,                  % how far the line-numbers are from the code
        frame=single,                   % adds a frame around the code
        framextopmargin=2pt,
        framexbottommargin=2pt,
        columns=fullflexible,
        rulecolor=\color{black!30},     % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
        tabsize=2,                      % sets default tabsize to 2 spaces
        showtabs=true,                  % show tabs within strings adding particular underscores
        showspaces=false,               % show spaces adding particular underscores
        keepspaces=true,
        showstringspaces=false,         % underline spaces within strings
        title=\lstname,                 % show the filename of files included with \lstinputlisting;
        escapeinside={\%*}{*)},         % if you want to add LaTeX within your code
        captionpos=b,                   % sets the caption-position to bottom
        breaklines=true,                % sets automatic line breaking
        breakatwhitespace=true,         % sets if automatic breaks should only happen at whitespace
        inputencoding=utf8,
        extendedchars=true,
        literate={*}{{\char42}}1 {-}{{\char45}}1,
        texcl=true,
        keywordstyle=\color{blue},      % keyword style
        commentstyle=\color{dkgreen},   % comment style
        stringstyle=\color{mauve},      % string literal style
    }

    \input{head.tex}
    \input{index.tex}
\end{document}
