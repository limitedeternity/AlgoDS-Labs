\documentclass[12pt, a4paper]{article}
\usepackage{xltxtra}

\usepackage{amsmath,amsfonts,amssymb,amsthm}
\usepackage{fontspec}
\defaultfontfeatures{Ligatures=TeX,Mapping=tex-text}
\setmainfont{CMU Serif}
\newfontfamily\cyrillicfont[Script=Cyrillic]{CMU Serif}
\setmonofont{CMU Typewriter Text}
\newfontfamily\cyrillicfonttt[Script=Cyrillic]{CMU Typewriter Text}
\setsansfont{CMU Sans Serif}
\newfontfamily\cyrillicfontsf[Script=Cyrillic]{CMU Sans Serif}

\usepackage{unicode-math}
\setmathfont{Latin Modern Math}

\usepackage{polyglossia}
\setmainlanguage[spelling=modern]{russian}
\setotherlanguage{english}
\setkeys{russian}{babelshorthands=true}

\usepackage[shortlabels]{enumitem}
\usepackage[russian,colorlinks,pagebackref]{hyperref}
\usepackage{listingsutf8}

\usepackage{csquotes}
\usepackage{fullpage}
\usepackage{color}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{indentfirst}

\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\graphicspath{{images/}}

\newtheorem{problem}{Задача}

\newenvironment{solution}
{\renewcommand\qedsymbol{$\blacksquare$}\begin{proof}[Решение]}
{\end{proof}}

\definecolor{dkviolet}{rgb}{0.3, 0.0, 0.5}
\definecolor{dkgreen}{rgb}{0.09, 0.45, 0.27}
\definecolor{ltblue}{rgb}{0.0, 0.4, 0.4}
\definecolor{dkblue}{rgb}{0.0, 0.0, 0.55}
\definecolor{dkred}{rgb}{0.55, 0.0, 0.0}
\definecolor{amber}{rgb}{1.0, 0.75, 0.0}
\definecolor{mauve}{rgb}{0.58, 0.0, 0.82}

\lstdefinelanguage{Coq}{
    % Vernacular commands
    morekeywords=[1]{Section, Module, End, Require, Import, Export,
        Variable, Variables, Parameter, Parameters, Axiom, Hypothesis,
        Hypotheses, Notation, Local, Tactic, Reserved, Scope, Open, Close,
        Bind, Delimit, Definition, Let, Ltac, Fixpoint, CoFixpoint, Add,
        Morphism, Relation, Implicit, Arguments, Unset, Contextual,
        Strict, Prenex, Implicits, Inductive, CoInductive, Record,
        Structure, Canonical, Coercion, Context, Class, Global, Instance,
        Program, Infix, Theorem, Lemma, Corollary, Proposition, Fact,
        Remark, Example, Proof, Goal, Save, Qed, Defined, Hint, Resolve,
        Rewrite, View, Search, Show, Print, Printing, All, Eval, Check,
        Projections, inside, outside, Def},
    % Gallina
    morekeywords=[2]{forall, exists, exists2, fun, fix, cofix, struct,
        match, with, end, as, in, return, let, if, is, then, else, for, of,
        nosimpl, when},
    % Sorts
    morekeywords=[3]{Type, Prop, Set, true, false, option},
    % Various tactics, some are std Coq subsumed by ssr, for the manual purpose
    morekeywords=[4]{pose, set, move, case, elim, apply, clear, hnf,
        intro, intros, generalize, rename, pattern, after, destruct,
        induction, using, refine, inversion, injection, rewrite, congr,
        unlock, compute, ring, field, fourier, replace, fold, unfold,
        change, cutrewrite, simpl, have, suff, wlog, suffices, without,
        loss, nat_norm, assert, cut, trivial, revert, bool_congr, nat_congr,
        symmetry, transitivity, auto, split, left, right, autorewrite},
    % Terminators
    morekeywords=[5]{by, done, exact, reflexivity, tauto, romega, omega,
        assumption, solve, contradiction, discriminate},
    % Control
    morekeywords=[6]{do, last, first, try, idtac, repeat},
    % String delimiters
    morestring=[b]",
    % Style for (listings') identifiers
    identifierstyle={\ttfamily\color{black}},
    % Style for declaration keywords
    keywordstyle=[1]{\ttfamily\color{dkviolet}},
    % Style for gallina keywords
    keywordstyle=[2]{\ttfamily\color{dkgreen}},
    % Style for sorts keywords
    keywordstyle=[3]{\ttfamily\color{ltblue}},
    % Style for tactics keywords
    keywordstyle=[4]{\ttfamily\color{dkblue}},
    % Style for terminators keywords
    keywordstyle=[5]{\ttfamily\color{dkred}},
    % Style for iterators
    keywordstyle=[6]{\ttfamily\color{amber}},
}[keywords,comments,strings]

\begin{document}
    \newcommand{\problemset}[1]{

        \begin{center}
            \Large #1
        \end{center}
    }

    \newcommand{\defeq}{\overset{\mathrm{def}}{=\joinrel=}}

    \lstset{
        language=C++,                   % the language of the code
        basicstyle=\ttfamily\small,     % the size of the fonts that are used for the code
        backgroundcolor=\color{white},  % choose the background color. You must add \usepackage{color}
        numbers=none,                   % where to put the line-numbers
        numbersep=0pt,                  % how far the line-numbers are from the code
        frame=single,                   % adds a frame around the code
        framextopmargin=2pt,
        framexbottommargin=2pt,
        columns=fullflexible,
        rulecolor=\color{black!30},     % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
        tabsize=2,                      % sets default tabsize to 2 spaces
        showtabs=true,                  % show tabs within strings adding particular underscores
        showspaces=false,               % show spaces adding particular underscores
        keepspaces=true,
        showstringspaces=false,         % underline spaces within strings
        title=\lstname,                 % show the filename of files included with \lstinputlisting;
        escapeinside={\%*}{*)},         % if you want to add LaTeX within your code
        captionpos=b,                   % sets the caption-position to bottom
        breaklines=true,                % sets automatic line breaking
        breakatwhitespace=true,         % sets if automatic breaks should only happen at whitespace
        inputencoding=utf8,
        extendedchars=true,
        literate={*}{{\char42}}1 {-}{{\char45}}1,
        texcl=true,
        keywordstyle=\color{dkviolet},  % keyword style
        commentstyle=\color{dkgreen},   % comment style
        stringstyle=\color{mauve},      % string literal style
    }

    \input{head.tex}
    \input{index.tex}
\end{document}
